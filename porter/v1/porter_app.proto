syntax = "proto3";

package porter.v1;

import "porter/v1/service.proto";

// PorterApp is the top-level configuration for a Porter application, usually found in porter.yaml
message PorterApp {
  // Name is the name of the application
  string name = 1;
  // Services is a map of service names to service configurations
  map<string, Service> services = 2;
  // Environ is a map of environment variable names to values
  map<string, string> env = 3;
  // Build is the build settings for the application
  Build build = 4;
  // Predeploy is a job service to run before deploying the application
  Service predeploy = 5;
  // Image is the image to use for a given revision of the application
  AppImage image = 6;
}

// Build is the build settings for the application
message Build {
  // Context is the path to the build context
  string context = 1;
  // Method is the build method to use, being one of "pack", "docker", or "registry"
  string method = 2;
  // Builder is the builder to use for the "pack" build method
  string builder = 3;
  // Buildpacks is a list of buildpacks to use for the "pack" build method
  repeated string buildpacks = 4;
  // Dockerfile is the path to the Dockerfile to use for the "docker" build method
  string dockerfile = 5;
}

// AppImage is the image to use for a given revision of the application
message AppImage {
  // Repository is the repository to use for the image
  string repository = 1;
  // Tag is the tag to use for the image
  string tag = 2;
}
